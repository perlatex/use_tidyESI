# 学科发展 {#progress}
 
## 潜力学科

当前四川师范大学在励精图治奋力耕耘，推动学科发展，其中**工程学**学科与进入ESI学科的阈值线最为接近，接近程度达到97.8%。其他各学科的发展情况见表 \@ref(tab:iris) 。

```{r}
univ_discip_cum_last_ten_year <- dt %>% 
    dplyr::filter(between(year_range, 2010, 2020)) %>% # last ten year
	dplyr::group_by(univ, discipline) %>%
	dplyr::summarise(
		cum_paper = sum(n_paper),
		cum_cited = sum(n_cited)
	) %>%
	dplyr::ungroup() %>% 
	tidyESI::add_is_enter_top(univ, discipline, source = enter) %>% 
	tidyESI::add_esi_threshold(discipline, date = "last") %>% 
	tidyESI::add_discipline_cn(discipline) %>% 
	tidyESI::add_univ_name_cn(univ)
#univ_discip_cum_last_ten_year
```



```{r iris}
univ_discip_cum_last_ten_year %>%
  dplyr::filter(univ_cn == "四川师范大学") %>%
  dplyr::select(discipline_cn, cum_paper, cum_cited, `20200514`) %>%
  dplyr::mutate(prop = cum_cited / `20200514`) %>%
  dplyr::arrange(desc(prop)) %>%
  dplyr::mutate(prop = scales::percent(prop, accuracy = 0.01)) %>%
  dplyr::select(
    "学科" = discipline_cn,
    "累积论文数" = cum_paper,
    "被引频次" = cum_cited,
    "阈值线" = `20200514`, "接近程度" = prop
  ) %>%
  knitr::kable(
    caption = "四川师范大学进入22ESI学科接近程度",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = "hold_position")
```


## 竞争对手

由表 \@ref(tab:iris)可以看出**工程学**是入选前百分之一ESI学科的 潜力学科，但我们也要意识到，当前师范院校高校中，工程学进入ESI学科的有14所，未进入的16所，表 \@ref(tab:iris3)列出了这未进入的16所高校的工程学科与阈值线的接近程度，可以看到，大学彼此之间竞争还很激烈。

```{r, eval=FALSE}
univ_discip_cum_last_ten_year %>%
  filter(discipline_cn %in% "工程学") %>%
  count(is_enter_top_one_percent)
```


```{r iris2}
univ_discip_cum_last_ten_year %>%
  dplyr::filter(discipline_cn %in% "工程学") %>%
  dplyr::filter(is.na(is_enter_top_one_percent)) %>%
  dplyr::mutate(prop = cum_cited / `20200514`) %>%
  dplyr::select(univ_cn, cum_paper, cum_cited, `20200514`, prop) %>%
  dplyr::arrange(desc(prop)) %>%
  dplyr::mutate(prop = scales::percent(prop, accuracy = 0.01)) %>%
  dplyr::select(
    "学校" = univ_cn,
    "累积论文数" = cum_paper,
    "累积被引频次" = cum_cited,
    "阈值线" = `20200514`,
    "接近程度" = prop
  ) %>%
  knitr::kable(
    caption = "工程学科有可能进入ESI学科的师范大学",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = "hold_position")
```


```{r iris3}
univ_discip_cum_last_ten_year %>%
  dplyr::filter(discipline_cn %in% "工程学") %>%
  dplyr::mutate(prop = cum_cited / `20200514`) %>%
  dplyr::select(
    univ_cn, cum_paper, cum_cited, `20200514`,
    prop, is_enter_top_one_percent
  ) %>%
  dplyr::arrange(desc(prop)) %>%
  dplyr::mutate(prop = scales::percent(prop, accuracy = 0.01)) %>%
  dplyr::mutate(is_enter = if_else(!is.na(is_enter_top_one_percent), "是", "否")) %>%
  dplyr::select(
    "学校" = univ_cn,
    "累积论文数" = cum_paper,
    "累积被引频次" = cum_cited,
    "阈值线" = `20200514`,
    "接近程度" = prop,
    "进入ESI" = is_enter
  ) %>%
  knitr::kable(
    caption = "师范类院校的工程学科进入ESI前百分之一学科的情况",
    booktabs = TRUE
  ) %>%
  kable_styling(latex_options = "hold_position")
```


## 有效论文数

这里需要使用 
`tidyESI::add_is_enter_top(univ, discipline, source = enter, .keep = TRUE)`获得有效论文数和有效被引频次. 我认为这是很有价值的一张表

```{r}
d_eff <- dt %>%
  dplyr::filter(between(year_range, 2010, 2020)) %>% # last ten year
  dplyr::group_by(univ, discipline) %>%
  dplyr::summarise(
    cum_paper = sum(n_paper),
    cum_cited = sum(n_cited)
  ) %>%
  dplyr::ungroup() %>%
  tidyESI::add_is_enter_top(univ, discipline, source = enter, .keep = TRUE) %>%
  tidyESI::add_esi_threshold(discipline, date = "last") %>%
  tidyESI::add_discipline_cn(discipline) %>%
  tidyESI::add_univ_name_cn(univ) %>%
  dplyr::filter(discipline_cn %in% "工程学") %>%
  dplyr::mutate(prop = cum_cited / `20200514`) %>% 

  dplyr::select(
    univ_cn, cum_paper, cum_cited, n_paper_eff, n_cited_eff, `20200514`,
    prop, is_enter_top_one_percent
  ) %>%
  dplyr::arrange(desc(prop)) %>%
  dplyr::mutate(prop = scales::percent(prop, accuracy = 0.01)) %>%
  dplyr::mutate(is_enter = if_else(!is.na(is_enter_top_one_percent), "是", "否")) 

#d_eff
```



```{r}
d_eff %>% 
  dplyr::select(
    "学校" = univ_cn,
    "累积论文数" = cum_paper,
    "累积被引频次" = cum_cited,
    "有效论文数" = n_paper_eff,
    "有效被引频次" = n_cited_eff,
    "阈值线" = `20200514`,
    "接近程度" = prop,
    "进入ESI" = is_enter ) %>%
  knitr::kable(
    caption = "师范类院校的工程学科进入ESI前百分之一学科的情况",
    booktabs = TRUE
  ) %>%
  kableExtra::kable_styling(latex_options = "hold_position")
```



## 好看的表格格

```{r}
d_eff %>% 
  #head(30) %>% 
  dplyr::mutate(
     prop = stringr::str_replace(prop, "%", "\\\\%")  # important
 ) %>% 
  dplyr::select(
    "学校" = univ_cn,
    "累积论文数" = cum_paper,
    "累积被引频次" = cum_cited,
    "有效论文数" = n_paper_eff,
    "有效被引频次" = n_cited_eff,
    "阈值线" = `20200514`,
    "接近程度" = prop,
    "进入ESI" = is_enter ) %>% 
  
  knitr::kable(
    format = "latex",
    escape = FALSE,
    booktabs = TRUE,
    col.names = linebreak(
      c(
        "学校",
        "累积 \n 论文数",
        "累积 \n 被引频次",
        "有效 \n 论文数",
        "有效 \n 被引频次",
        "阈值线",
        "接近程度",
        "进入 \n ESI" ), 
      align = "c"
    ),
    caption = "师范类院校的工程学科进入ESI前百分之一学科的情况"
  ) %>%
  kableExtra::kable_styling(
      latex_options = "hold_position"
  )
```

## 虚高成分多大？

可以看已经进入ESI学科的若干高校，n_paper/n_paper_eff
画个图，看这个比率是多大，然后反推川师的n_paper_eff

```{r}
d_eff
```
```{r}
d_eff %>% 
  dplyr::filter(!is.na(n_cited_eff)) %>% 
  
  ggplot(aes(x = cum_cited, y = n_cited_eff)) +
  geom_point() + 
  geom_text_repel(aes(label = univ_cn)) +
  geom_smooth(method = lm, se = FALSE)
```
这个发现真的有趣，竟然是接近一条直线。

```{r}
mod <- d_eff %>% 
  dplyr::filter(!is.na(n_cited_eff)) %>% 
  lm(n_cited_eff ~ cum_cited, data = .)

broom::tidy(mod)
```

```{r}
tbl_pred <- d_eff %>% 
  dplyr::filter(univ_cn == "四川师范大学") %>% 
  modelr::add_predictions(data = ., model = mod, var = "n_cited_eff_pred") %>% 
  dplyr::mutate(prop_pred = n_cited_eff_pred/ `20200514`) %>% 
  dplyr::mutate(prop_pred = scales::percent(prop_pred, accuracy = 0.01)) %>%
  dplyr::select(univ_cn, cum_paper, cum_cited, `20200514`, prop, n_cited_eff_pred, prop_pred) %>% 
  dplyr::rename('学校' = univ_cn,
         '累计发文' = cum_paper,
         '累计引文' = cum_cited,
         '阈值' = `20200514`,
         '接近程度' = prop,
         '预测有效引文' = n_cited_eff_pred,
         '预测接近程度' = prop_pred)

tbl_pred
```

也就说，四川师范大学工程学科，与阈值的有效接近程度只是`95%`


```{r, fig.asp=0.618, fig.width= 6}
library(ggpmisc)
univ_focus <- c("北京师范大学", "杭州师范大学", "曲阜师范大学", "浙江师范大学",
                "南京师范大学", "华南师范大学", "陕西师范大学")

formula <- y ~ x

d_eff %>% 
  dplyr::filter(!is.na(n_cited_eff)) %>% 
  dplyr::mutate(
    univ_label = if_else(univ_cn %in% univ_focus, univ_cn, NA_character_) 
   ) %>% 
  
  ggplot(aes(x = cum_cited, y = n_cited_eff)) +
  geom_point(size = 2) + 
  geom_text_repel(aes(label = univ_label), size = 3) +
  geom_smooth(method = "lm", se = FALSE, formula = formula) +
  ggpmisc::geom_table_npc(data = tbl_pred,
		npcx = 0.01, npcy = 0.9, label = list(tbl_pred),
		size = 2.8
		) +
   ggpmisc::stat_poly_eq(
    aes(label = paste(stat(eq.label), stat(adj.rr.label), sep = "*\",  \"*") ),
    formula = formula, 
    label.x = 0.9, 
    label.y = 0.3,
    parse = TRUE
    ) +
	theme_classic() 

ggsave("prop_pred.pdf")
```

观测到的被引频次打个九折，就是有效被引频次

